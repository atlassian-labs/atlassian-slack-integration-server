<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
        <param name="atlassian-data-center-status">compatible</param>
        <param name="atlassian-data-center-compatible">true</param>

        <param name="plugin-icon">images/slack-logo-16px.png</param>
        <param name="plugin-logo">images/slack-logo-144px.png</param>
        <param name="vendor-icon">images/atlassian-logo-16px.png</param>
        <param name="vendor-logo">images/atlassian-logo-72px.png</param>
    </plugin-info>

    <resource type="i18n" name="slack-common" location="com.atlassian.plugins.slack.slack-common"/>
    <resource type="i18n" name="jira-slack" location="com.atlassian.jira.plugins.slack.jira-slack"/>
    <resource type="download" name="images/" location="images/"/>

    <!-- Personal notifications -->
    <web-item key="slack-user-personal-settings-link" section="system.user.profile.links/operations" weight="91">
        <label key="plugins.slack.pn.link.label"/>
        <link linkId="personal-notifications-slack-integration">/plugins/servlet/slack/personal-notifications</link>
        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
        <condition class="com.atlassian.jira.plugins.slack.web.condition.CurrentUserIsProfileUserCondition"/>
    </web-item>
    <servlet name="Slack Personal Notifications Servlet" key="slack-personal-notifications-servlet"
             class="com.atlassian.plugins.slack.user.SlackPersonalNotificationsServlet">
        <url-pattern>/slack/personal-notifications</url-pattern>
    </servlet>
    <web-resource key="slack-personal-settings-resources">
        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <dependency>com.atlassian.auiplugin:ajs</dependency>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>
        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>

        <resource type="download"
                  name="slack-feature/personal-notifications/personal-notifications.js"
                  location="slack-feature/personal-notifications/personal-notifications.js"/>
        <resource type="soy"
                  name="slack-feature/personal-notifications/personal-notifications.soy"
                  location="slack-feature/personal-notifications/personal-notifications.soy"/>
        <resource type="download"
                  name="slack-feature/personal-notifications/personal-notifications.less.css"
                  location="slack-feature/personal-notifications/personal-notifications.less"/>
    </web-resource>

    <!-- global admin -->
    <web-item key="admin-slack-integration-legacy" name="Slack Integration"
              section="top_system_section/mail_section" weight="149">
        <description key="jira.plugins.slack.integration.description"/>
        <label key="jira.plugins.slack.integration.title"/>
        <link linkId="admin-slack-integration">/plugins/servlet/slack/configure</link>
        <styleClass>icon-admin-serversettings</styleClass>
    </web-item>

    <web-item key="admin-slack-integration" name="Slack Integration"
              section="admin_applications_section/admin_applications_integrations_section" weight="29">
        <description key="jira.plugins.slack.integration.description"/>
        <label key="jira.plugins.slack.integration.applications.title"/>
        <link linkId="admin-slack-integration">/plugins/servlet/slack/configure</link>
        <styleClass>icon-admin-serversettings</styleClass>
    </web-item>

    <!-- Link to view Slack OAuth token -->
    <web-item key="slack-oauth-profile-page" section="system.user.profile.links/operations" weight="92">
        <label key="slack.view.oauth.label"/>
        <link linkId="admin-slack-integration">/plugins/servlet/slack/view-oauth-sessions</link>
        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
        <condition class="com.atlassian.jira.plugins.slack.web.condition.CurrentUserIsProfileUserCondition"/>
    </web-item>

    <!-- Images -->
    <web-resource name="Image Resources" key="slack-jira-image-resources">
        <resource name="images/jira-slack-not-connected.svg" type="download" location="images/jira-slack-not-connected.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource name="images/jira-slack-is-connected.svg" type="download" location="images/jira-slack-is-connected.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource name="images/jira-slack-installing.svg" type="download" location="images/jira-slack-installing.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource type="download" name="images/slack-needs-signin.svg" location="images/slack-needs-signin.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource type="download" name="images/big-news.svg" location="images/big-news.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource type="download" name="images/new-slack-not-connected.svg" location="images/new-slack-not-connected.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
    </web-resource>

    <!-- Global and util resources that should be included everywhere TODO delete? -->
    <web-resource key="global" name="slack-global-resources">
        <transformation extension="less">
            <transformer key="less-transformer"/>
        </transformation>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-backbone-resource</dependency>

        <resource type="download" name="slack.js" location="js/slack-base.js"/>
        <resource type="download" name="slack-configure.css" location="slack-less/slack-configure.less"/>
    </web-resource>

    <!-- Project configuration -->

    <web-resource key="slack-project-config-soy-templates">
        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <dependency>com.atlassian.jira.jira-project-config-plugin:project-config-global</dependency>
        <dependency>com.atlassian.soy.soy-template-plugin:soy-deps</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-integration-steps-resources</dependency>

        <resource name="slack-configure-project.soy" type="soy" location="slack-soy/configureproject/configureprojectpage.soy"/>
        <resource name="feature-channelmapping-channelmapping.soy" type="soy" location="slack-soy/channelmapping/channelmapping.soy"/>
        <resource name="feature-channelmapping-channelmapping-client-soy.js" type="soy" location="slack-soy/channelmapping/channelmapping-client.soy"/>
        <resource name="slack-settings.soy" type="soy" location="slack-soy/settings/settings.soy"/>
    </web-resource>

    <web-resource key="slack-backbone-resource">
        <dependency>jira.webresources:backbone-1.0.0</dependency>
        <resource type="download" name="slack-backbone-amd.js" location="js/lib/backbone-amd.js"/>
    </web-resource>

    <web-resource key="feature-channelmapping-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>
        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>

        <resource type="download" name="slack-feature-channelmapping-querymodule.js" location="js/slack-feature/channelmapping/querymodule.js"/>
        <resource type="download" name="slack-feature-channelmapping-mapping-setting.js" location="js/slack-feature/channelmapping/mapping-setting.js"/>
        <resource type="download" name="slack-feature-channelmapping-mapping.js" location="js/slack-feature/channelmapping/mapping.js"/>
        <resource type="download" name="slack-feature-channelmapping-mapping-collection.js" location="js/slack-feature/channelmapping/mapping-collection.js"/>
        <resource type="download" name="slack-feature-channelmapping-mapping-view.js" location="js/slack-feature/channelmapping/mapping-view.js"/>
        <resource type="download" name="slack-feature-channelmapping-channelmapping-page.js" location="js/slack-feature/channelmapping/channelmapping-page.js"/>
        <resource type="download" name="slack-feature-channelmapping-channelmapping-init.js" location="js/slack-feature/channelmapping/channelmapping-init.js"/>

        <resource type="download" name="slack-feature-channelmapping-channelmapping-client-soy.js" location="slack-soy/channelmapping/channelmapping-client.soy"/>
        <resource type="download" name="slack-feature-channelmapping-channelmapping.css" location="js/slack-feature/channelmapping/channelmapping.less"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:global</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-widget-criteria-resources</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:widget-channelselector</dependency>
        <dependency>com.atlassian.auiplugin:aui-select2</dependency>
        <dependency>com.atlassian.auiplugin:aui-dropdown2</dependency>
        <dependency>com.atlassian.soy.soy-template-plugin:soy-deps</dependency>
        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <dependency>com.atlassian.jira.jira-issue-nav-components:query</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:base-slack-common-resources</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-integration-steps-resources</dependency>
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-backbone-resource</dependency>
    </web-resource>

    <web-resource key="widget-channelselector">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>
        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>

        <resource type="download" name="slack-widget-channelselector-channelmapping-service.js" location="js/slack-widget/channelselector/channelmapping-service.js"/>
        <resource type="download" name="slack-widget-channelselector-channelselector-view.js" location="js/slack-widget/channelselector/channelselector-view.js"/>

        <resource type="download" name="slack-widget-channelselector-channelselector.css" location="slack-less/widget/channelselector/channelselector.less"/>
        <resource type="download" name="slack-widget-channelselector-teamselector.less" location="slack-less/widget/channelselector/teamselector.less"/>

        <resource type="download" name="slack-widget-channelselector-channelselector-client-soy.js" location="slack-soy/widget/channelselector/channelselector-client.soy"/>
        <resource name="slack-issuepanel-client-soy.js" type="download" location="slack-soy/issuepanel/issuepanel-client.soy"/>

        <resource type="download" name="slack-images/public_channel.png" location="images/public_channel.png"/>
        <resource type="download" name="slack-images/public_channel@2x.png" location="images/public_channel@2x.png"/>
        <resource type="download" name="slack-images/private_channel.png" location="images/private_channel.png"/>
        <resource type="download" name="slack-images/private_channel@2x.png" location="images/private_channel@2x.png"/>
        <resource type="download" name="slack-images/public_channel_active.png" location="images/public_channel_active.png"/>
        <resource type="download" name="slack-images/public_channel_active@2x.png" location="images/public_channel_active@2x.png"/>
        <resource type="download" name="slack-images/private_channel_active.png" location="images/private_channel_active.png"/>
        <resource type="download" name="slack-images/private_channel_active@2x.png" location="images/private_channel_active@2x.png"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:global</dependency>
        <dependency>com.atlassian.auiplugin:aui-select2</dependency>
        <dependency>com.atlassian.soy.soy-template-plugin:soy-deps</dependency>
        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-backbone-resource</dependency>
    </web-resource>

    <web-resource key="slack-project-config-resources">
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:feature-channelmapping-resources</dependency>
        <resource type="download" name="slack-settings.js" location="js/slack-feature/settings/slack-settings.js"/>
        <resource type="download" name="slack-settings.css" location="css/slack-settings.less"/>
        <resource type="download" name="images/slack-autoconvert-preview.png" location="images/slack-autoconvert-preview.png"/>
        <context>jira.plugin.slack.project.configure</context>
    </web-resource>

    <!-- WIDGETS -->

    <!-- WIDGETS: Criteria -->
    <web-resource key="slack-widget-criteria-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource type="download" name="slack-widget-criteria.js" location="js/slack-widget/criteria/criteria.js"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:global</dependency>
        <dependency>com.atlassian.jira.jira-issue-nav-components:query</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-backbone-resource</dependency>
    </web-resource>

    <web-item key="slack-project-notifications" name="Project Slack Notifications Configuration" section="atl.jira.proj.config/projectgroup4"
              i18n-name-key="jira.plugins.slack.project.admin.link" weight="99">
        <label key="jira.plugins.slack.project.admin.link" />
        <link linkId="slack-project-admin-page-link">/secure/ConfigureSlack.jspa?projectKey=$projectKeyEncoded</link>
    </web-item>

    <webwork1 key="configure-slack-project" name="Configure Slack for Project Action" class="java.lang.Object">
        <actions>
            <action name="com.atlassian.jira.plugins.slack.web.actions.SlackConfigureProjectAction" alias="ConfigureSlack">
                <view name="success" type="soy">:slack-project-config-soy-templates/JIRA.Templates.Slack.Project.Admin.configurePage</view>
                <view name="error" type="soy">:slack-project-config-soy-templates/JIRA.Templates.Slack.Project.Admin.errorPage</view>
                <view name="securitybreach">/secure/views/securitybreach.jsp</view>
                <view name="install" type="dispatcher">/secure/InstallSlack.jspa</view>
            </action>
            <action name="com.atlassian.jira.plugins.slack.web.actions.SlackInstallProjectAction" alias="InstallSlack">
                <view name="success" type="soy">:slack-project-config-soy-templates/JIRA.Templates.Slack.Project.Admin.installPage</view>
            </action>
            <action name="com.atlassian.jira.plugins.slack.web.actions.SlackEditGlobalSettings" alias="EditSlackGlobalSettings">
                <view name="success" type="soy">:slack-project-config-soy-templates/JIRA.Templates.Slack.Settings.globalConfiguration</view>
            </action>
            <action name="com.atlassian.jira.plugins.slack.web.actions.SlackEditProjectSettings" alias="EditSlackProjectSettings">
                <view name="success" type="soy">:slack-project-config-soy-templates/JIRA.Templates.Slack.Settings.projectConfiguration</view>
            </action>
        </actions>
    </webwork1>

    <!-- Active Objects Tables -->
    <ao key="jira-slack-ao" namespace="com.atlassian.plugins.slack-integration-plugin">
        <description>AO classes for slack and jira</description>
        <entity>com.atlassian.jira.plugins.slack.model.ao.ProjectConfigurationAO</entity>
        <entity>com.atlassian.plugins.slack.ao.AOSlackLink</entity>
        <entity>com.atlassian.plugins.slack.ao.AOSlackUser</entity>

        <upgradeTask>com.atlassian.jira.plugins.slack.model.ao.upgrade.v1.ProjectConfigurationUpgradeTask001</upgradeTask>
    </ao>

    <!-- Slack REST endpoints -->

    <!--REST v2 migration tag to enable REST v2-->
    <rest-migration key="jira-slack-key">
        <rest-v2/>
    </rest-migration>

    <rest key="slack-rest" name="Slack Jira Resources" path="/slack" version="1.0">
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>FORWARD</dispatcher>
    </rest>

    <workflow-function key="slack-post-function" name="Slack Post Function"
                       i18n-name-key="slack-post-function.name"
                       class="com.atlassian.jira.plugins.slack.postfunction.SlackPostFunctionFactory">
        <description key="slack-post-function.description">The Slack Post Function Plugin</description>
        <function-class>com.atlassian.jira.plugins.slack.postfunction.SlackPostFunction</function-class>
        <resource type="velocity" name="view" location="templates/postfunctions/slack-post-function.vm"/>
        <resource type="velocity" name="input-parameters"
                  location="templates/postfunctions/slack-post-function-input.vm"/>
        <resource type="velocity" name="edit-parameters"
                  location="templates/postfunctions/slack-post-function-input.vm"/>
    </workflow-function>

    <web-resource name="Common Resources" key="slack-common-jira-resources">
        <context>atl.general</context>
        <context>atl.admin</context>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>

        <resource name="jira-slack-status.js" type="download" location="js/jira-slack-status.js"/>
        <resource name="mute-bulk-edit-notifications-toggle.js" type="download" location="js/mute-bulk-edit-notifications-toggle.js"/>
        <resource name="slack-styles.css" type="download" location="css/slack-styles.css"/>
        <resource type="download" name="slack-images/" location="images/"/>
        <resource type="download" name="jira-slack-user-link.soy.js" location="slack-soy/jira-slack-user-link.soy" />
        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
    </web-resource>

    <web-resource name="SlackChannelPicker" key="slackChannelPicker">
        <context>atl.admin</context>

        <dependency>jira.webresources:select-pickers</dependency>
        <dependency>com.atlassian.auiplugin:aui-select</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:widget-channelselector</dependency>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource name="initSlackChannelPickers.js" type="download" location="js/initSlackChannelPickers.js"/>

        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
    </web-resource>

    <web-resource name="Slack Notification JQL Resources" key="slack-notification-jql-resources">
        <dependency>jira.webresources:jqlautocomplete</dependency>

        <resource name="slack-jql-autocomplete.js" type="download" location="js/slack-jql-autocomplete.js"/>
        <resource name="slack-jql-autocomplete.css" type="download" location="css/slack-jql-autocomplete.css"/>

        <context>atl.admin</context>
    </web-resource>

    <web-resource name="Slack Formatting to HTML" key="slackdown-resources">
        <resource name="slackdown.js" type="download" location="js/slackdown.js"/>
    </web-resource>

    <web-resource name="Slack Notification Preview Resources" key="slack-notification-preview-resources">
        <resource name="slack-notification-preview.js" type="download" location="js/slack-notification-preview.js"/>
        <resource name="slack-notification-preview.css" type="download" location="css/slack-notification-preview.css"/>
        <resource name="slack-notification-preview-template-soy.js" type="download" location="slack-soy/notification/slack-notification-preview.soy"/>

        <resource name="slack-notification-editor.js" type="download" location="js/slack-notification-editor.js"/>
        <resource name="slack-notification-editor.css" type="download" location="css/slack-notification-editor.css"/>

        <transformation extension="soy">
            <transformer key="jiraSoyTransformer"/>
        </transformation>
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slackdown-resources</dependency>
        <context>atl.admin</context>
    </web-resource>

    <web-resource key="slack-soy-server-resources" name="Slack Server-side Soy Resources">
        <resource type="soy" name="slack-common" location="slack-soy/configure/slack-config.soy"/>
        <resource type="soy" name="slack-feature-channelmapping-channelmapping.soy"  location="slack-soy/channelmapping/channelmapping.soy"/>
        <resource type="soy" name="slack-feature-channelmapping-channelmapping-client.soy"  location="slack-soy/channelmapping/channelmapping-client.soy"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-soy-resources</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-integration-steps-resources</dependency>
    </web-resource>

    <!-- Global install -->
    <web-resource key="slack-jira-global-configuration-resources" name="Slack global configuration resources">
        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>

        <resource type="download" name="slack-configure.css" location="slack-less/slack-configure.less"/>
        <resource type="download" name="slack-settings.js" location="js/slack-feature/settings/slack-settings.js"/>
        <resource type="download" name="slack-settings.css" location="css/slack-settings.less"/>
        <resource type="download" name="images/slack-autoconvert-preview.png" location="images/slack-autoconvert-preview.png"/>

        <context>slack-global-configuration-install</context>
        <context>slack-global-configuration</context>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-integration-steps-resources</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:feature-channelmapping-resources</dependency>
    </web-resource>

    <web-panel key="slack-jira-global-install" location="slack.integration.configure.install">
        <resource name="view" type="soy"
                  location="com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-soy-server-resources/JIRA.Templates.Slack.Config.configure"/>
    </web-panel>

    <web-panel key="slack-space-to-channel-global" location="slack.integration.configure.installed">
        <context-provider class="com.atlassian.jira.plugins.slack.web.contextproviders.SlackGlobalAdminDataProvider"/>
        <resource name="view" type="soy"
                  location="com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-soy-server-resources/JIRA.Templates.Slack.Config.renderChannelMapping"/>
    </web-panel>

    <analytics-whitelist key="jiraSlackIntegrationPluginAnalyticsWhitelist" resource="analytics/whitelist.json"/>

    <!-- Slack web panel on the View Issue page -->
    <web-panel key="slack-viewissue-panel"  location="atl.jira.view.issue.right.context" weight="109" class="com.atlassian.jira.plugins.slack.web.panels.IssueWebPanel">
        <label key="jira.plugins.slack.viewissue.panel.title" />
        <!-- Show panel only if: -->
        <!--     1. User is logged in -->
        <!-- AND 2. Panel is not hidden in settings -->
        <!-- AND   3a. User is global admin -->
        <!--    OR 3b. User is project admin -->
        <!--    OR 3c. User can modify issue (regular not admin user) -->
        <conditions type="AND">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserLoggedInCondition"/>
            <condition class="com.atlassian.jira.plugins.slack.web.condition.ShowIssuePanelCondition"/>
            <conditions type="OR">
                <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsAdminCondition" />
                <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasProjectPermissionCondition">
                    <param name="permission">browse</param>
                </condition>
                <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasProjectPermissionCondition">
                    <param name="permission">project</param>
                </condition>
                <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasProjectPermissionCondition">
                    <param name="permission">edit</param>
                </condition>
            </conditions>
        </conditions>
        <dependency>com.atlassian.auiplugin:aui-spinner</dependency>
        <dependency>com.atlassian.auiplugin:aui-dropdown2</dependency>
    </web-panel>

    <web-resource key="slack-viewissue-panel-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>

        <resource name="slack-issuepanel.soy" type="soy" location="slack-soy/issuepanel/issuepanel.soy"/>
        <resource name="slack-issuepanel-client.soy" type="soy" location="slack-soy/issuepanel/issuepanel-client.soy"/>
        <resource name="slack-issuepanel-soy.js" type="download" location="slack-soy/issuepanel/issuepanel.soy"/>
        <resource name="slack-issuepanel-client-soy.js" type="download" location="slack-soy/issuepanel/issuepanel-client.soy"/>
        <resource name="slack-issuepanel.css" type="download" location="slack-less/issuepanel.less"/>
        <resource name="slack-dedicatedchannel.js" type="download" location="js/slack-feature/issuepanel/dedicatedchannel.js"/>
        <resource name="slack-dedicatedchannel-view.js" type="download" location="js/slack-feature/issuepanel/dedicatedchannel-view.js"/>
        <resource name="slack-issuemention.js" type="download" location="js/slack-feature/issuepanel/issuemention.js"/>
        <resource name="slack-issuemention-view.js" type="download" location="js/slack-feature/issuepanel/issuemention-view.js"/>
        <resource name="slack-issuepanel-view.js" type="download" location="js/slack-feature/issuepanel/issuepanel-view.js"/>
        <resource name="slack-issuepanel-init.js" type="download" location="js/slack-feature/issuepanel/issuepanel-init.js"/>

        <resource type="download" name="slack-links-settings-dialog-soy.js" location="slack-soy/configure/slack-link-dialog.soy"/>

        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <dependency>com.atlassian.auiplugin:aui-select</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slackdown-resources</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-links-support</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-user-link-support</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:widget-channelselector</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-backbone-resource</dependency>

        <context>slack-issue-panel</context>
        <context>jira.view.issue</context>

        <condition class="com.atlassian.jira.plugins.slack.web.condition.UserLoggedInUrlReadingCondition"/>
    </web-resource>

    <webwork1 key="slack-issue-panel-actions" name="Slack Issue Panel Action" class="java.lang.Object">
        <actions>
            <action name="com.atlassian.jira.plugins.slack.web.actions.SlackSelectDedicatedChannelAction" alias="SlackSelectChannel">
                <view name="success" type="soy">:slack-viewissue-panel-resources/JIRA.Templates.Slack.Project.IssuePanel.selectChannelDialog</view>
            </action>
            <action name="com.atlassian.jira.plugins.slack.web.actions.SlackIssueMentionsAction" alias="SlackMentionedChannels">
                <view name="success" type="soy">:slack-viewissue-panel-resources/JIRA.Templates.Slack.Project.IssuePanel.mentionedChannelDialog</view>
                <view name="error" type="soy">:slack-viewissue-panel-resources/JIRA.Templates.Slack.Project.IssuePanel.errorPage</view>
                <view name="slackLogin" type="soy">:slack-viewissue-panel-resources/JIRA.Templates.Slack.Project.IssuePanel.loginMentionsDialog</view>
            </action>
        </actions>
    </webwork1>

    <!-- Web resource to tell to admins that they need to update the plugin OAuth link with Slack -->
    <web-resource key="slack-update-plugin-banner-resources" name="Update Plugin Resource Banner">
        <dependency>jira.webresources:messages</dependency>
        <dependency>jira.webresources:util-lite</dependency><!-- for the logged in user util -->
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-links-support</dependency>

        <transformation extension="soy">
            <transformer key="soyTransformer" />
        </transformation>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>

        <resource type="download" name="slack-update-banner.css" location="slack-less/banner/update-banner.less"/>
        <resource type="download" name="slack-update-slack-link-banner.js" location="js/banner/update-slack-link-banner.js" />
        <resource type="download" name="slack-update-slack-link-banner-client-soy.js" location="slack-soy/banner/update-slack-link-banner.soy" />

        <context>atl.general</context>
        <context>atl.admin</context>
    </web-resource>

    <web-resource name="Migrate to Slack Resources" key="migrate-to-slack-resources">
        <dependency>jira.webresources:select-pickers</dependency>
        <dependency>jira.webresources:messages</dependency>
        <dependency>com.atlassian.auiplugin:aui-select2</dependency>
        <dependency>com.atlassian.auiplugin:aui-dropdown2</dependency>
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.auiplugin:aui-experimental-spinner</dependency>
        <dependency>com.atlassian.soy.soy-template-plugin:soy-deps</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-global</dependency>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <transformation extension="soy">
            <transformer key="soyTransformer">
            </transformer>
        </transformation>

        <transformation extension="less">
            <transformer key="lessTransformer"/>
            <transformer key="less-transformer"/>
        </transformation>

        <resource type="download" name="images/slack-logo.svg" location="images/slack-logo.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource type="download" name="images/slack-logo-check.svg" location="images/slack-logo-check.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
        <resource type="download" name="js/slack-fuse.min.js" location="js/slack-fuse.min.js"/>
        <resource type="download" name="slack-less/migrate-to-slack.less.css" location="slack-less/migrate-to-slack.less"/>
        <resource type="download" name="js/migrate-to-slack.js" location="js/migrate-to-slack.js" />
        <resource type="download" name="slack-soy/migrate-to-slack.soy.js" location="slack-soy/migrate-to-slack.soy"/>

        <context>admin</context>
        <context>atl.admin</context>

        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
    </web-resource>

    <webwork1 key="migrate-to-slack-actions" name="Migrate to Slack Action" class="java.lang.Object">
        <actions>
            <action name="com.atlassian.jira.plugins.slack.web.actions.MigrateToSlackAction" alias="MigrateToSlackAction">
                <view name="success" type="soy">:migrate-to-slack-resources/Slack.Templates.Migration.selectChannelDialog</view>
            </action>
        </actions>
    </webwork1>

    <web-resource name="Link Error Resources" key="slack-link-error-resources">
        <dependency>jira.webresources:messages</dependency>
        <context>atl.general</context>
        <context>atl.admin</context>

        <data key="slack-link-error" class="com.atlassian.plugins.slack.oauth2.LinkErrorDataProvider" />

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource name="oauth2/jira-slack-link-error.js" type="download" location="oauth2/jira-slack-link-error.js"/>

        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
    </web-resource>

    <!-- Below are the resources from the common project -->

    <servlet name="Configure Slack Servlet" key="slack-configure-servlet"
             class="com.atlassian.plugins.slack.admin.ConfigureServlet">
        <url-pattern>/slack/configure</url-pattern>
    </servlet>

    <web-panel key="slack-configurationPanel" location="plugins.slack.configure">
        <context-provider class="com.atlassian.plugins.slack.admin.SlackConfigurationScreenContextProvider"/>
        <resource name="view" type="soy" location="com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-soy-resources/Slack.Templates.Configuration.panel"/>
    </web-panel>

    <web-resource key="slack-global">
        <transformation extension="less">
            <!-- lessTransformer is the legacy name for Jira, we can change it to less-transformer once we drop older version of Jira -->
            <transformer key="lessTransformer"/>
            <transformer key="less-transformer"/>
        </transformation>

        <resource name="slack-global.css" type="download" location="stylesheets/slack-global.less"/>

        <dependency>com.atlassian.auiplugin:ajs</dependency>
    </web-resource>

    <web-resource name="Slack Link Screen Resources" key="slack-base-link-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <transformation extension="soy">
            <transformer key="soyTransformer">
            </transformer>
        </transformation>

        <transformation extension="less">
            <transformer key="lessTransformer"/>
            <transformer key="less-transformer"/>
        </transformation>

        <resource type="download" name="stylesheets/slack-main.css" location="stylesheets/slack-main.less"/>
        <resource type="download" name="admin/configure-slack.js" location="admin/configure-slack.js"/>
        <resource type="download" name="configure-slack.soy.js" location="admin/configure-slack.soy"/>

        <dependency>com.atlassian.auiplugin:aui-experimental-spinner</dependency>
        <dependency>com.atlassian.soy.soy-template-plugin:soy-deps</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-global</dependency>

        <context>admin</context>
        <context>atl.admin</context>
    </web-resource>

    <web-resource name="Connect to Slack Workspace" key="slack-connect-workspace-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource type="download" name="slack-admin/connect/connect-workspace.js" location="admin/connect/connect-workspace.js"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-base-link-resources</dependency>
    </web-resource>

    <web-resource name="Manage Slack Workspaces" key="manage-workspaces-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource type="download" name="slack-admin/manage/manage-workspaces.js" location="admin/manage/manage-workspaces.js"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-base-link-resources</dependency>
    </web-resource>

    <web-resource key="slack-user-link-support">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource type="download" name="user/slack-user-link.js" location="user/slack-user-link.js"/>

        <dependency>com.atlassian.auiplugin:aui-core</dependency>
    </web-resource>

    <web-resource name="Slack Common Resources" key="base-slack-common-resources">
        <transformation extension="less">
            <transformer key="lessTransformer"/>
            <transformer key="less-transformer"/>
        </transformation>

        <resource type="download" name="stylesheets/slack-channel-mappings.css" location="stylesheets/slack-channel-mappings.less"/>

        <dependency>com.atlassian.auiplugin:aui-dropdown2</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-user-link-support</dependency>
    </web-resource>

    <web-resource name="Slack Links Support" key="slack-links-support">
        <context>atl.general</context>
        <context>atl.admin</context>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource type="download" name="cookie/js.cookie.js" location="cookie/js.cookie.js"/>
        <resource type="download" name="links/slack-links.js" location="links/slack-links.js"/>
    </web-resource>

    <web-resource name="Image Resources" key="slack-image-resources">
        <resource type="download" name="images/slack-installing.svg" location="images/slack-installing.svg">
            <param name="content-type" value="image/svg+xml"/>
        </resource>
    </web-resource>

    <web-resource name="Slack Link Screen Resources" key="slack-soy-resources">
        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <resource type="soy" name="slack-panel" location="admin/configure-slack.soy"/>
        <resource type="soy" name="slack-server" location="admin/configure-server-slack.soy"/>
    </web-resource>

    <web-resource name="Slack Integration Steps resources" key="slack-integration-steps-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <transformation extension="less">
            <transformer key="lessTransformer"/>
            <transformer key="less-transformer"/>
        </transformation>

        <resource type="download" name="slack-feature/integrationsteps/integrationsteps.css" location="slack-feature/integrationsteps/integrationsteps.less"/>
        <resource type="soy" name="slack-feature/integrationsteps/integrationsteps.soy" location="slack-feature/integrationsteps/integrationsteps.soy"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-global</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-connection-status-resources</dependency>
    </web-resource>

    <web-resource name="Slack Connection Status resources" key="slack-connection-status-resources">
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <transformation extension="less">
            <transformer key="lessTransformer"/>
            <transformer key="less-transformer"/>
        </transformation>

        <transformation extension="soy">
            <transformer key="soyTransformer">
                <functions>com.atlassian.confluence.plugins.soy:soy-core-functions</functions>
            </transformer>
        </transformation>

        <resource type="download" name="slack-feature/connectionstatus/connectionstatus-soy.js" location="slack-feature/connectionstatus/connectionstatus.soy"/>
        <resource type="soy" name="slack-feature/connectionstatus/connectionstatus.soy" location="slack-feature/connectionstatus/connectionstatus.soy"/>

        <resource type="download" name="slack-feature/connectionstatus/connectionstatus.js" location="slack-feature/connectionstatus/connectionstatus.js"/>
        <resource type="download" name="slack-feature/connectionstatus/connectionstatus.css" location="slack-feature/connectionstatus/connectionstatus.less"/>

        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-global</dependency>
        <!-- to show connection status tooltip on channel mapping page -->
        <dependency>com.atlassian.auiplugin:aui-inline-dialog2</dependency>
    </web-resource>

    <web-resource name="Disconnected Token Resources" key="slack-disconnected-token-resources">
        <context>atl.general</context>
        <context>atl.admin</context>

        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>

        <resource name="token/token-status.js" type="download" location="token/token-status.js"/>

        <condition class="com.atlassian.plugins.slack.api.condition.IsSlackEnabledUrlReadingCondition"/>
        <condition class="com.atlassian.jira.plugins.slack.web.condition.UserLoggedInUrlReadingCondition"/>
    </web-resource>

    <soy-function key="slack-plugin-resource-url" name="Generates a url for a plugin resource" class="com.atlassian.plugins.slack.soy.PluginResourceUrlSlackFunction"/>
    <soy-function key="slack-web-panel-soy-function" name="Generates the html for a web panel" class="com.atlassian.plugins.slack.soy.WebPanelsSlackFunction"/>
    <soy-function key="slack-require-resource-by-context-function" name="Requires resources for a given context" class="com.atlassian.plugins.slack.soy.RequireSlackResourceByContextSlackFunction"/>
    <soy-function key="slack-get-product-text" name="Generates each text passing the product name as the first parameter"
                  class="com.atlassian.plugins.slack.soy.GetProductTextSlackFunction"/>
    <soy-function key="slack-add-query-param" name="Add a query param to an URI"
                  class="com.atlassian.plugins.slack.soy.AddQueryParamSlackFunction"/>

    <analytics-whitelist key="atlassianSlackIntegrationAnalyticsWhitelist" resource="analytics/whitelist-base.json"/>

    <web-resource key="slack-view-oauth-resources">
        <dependency>com.atlassian.auiplugin:aui-experimental-soy-templates</dependency>
        <dependency>com.atlassian.jira.plugins.jira-slack-server-integration-plugin:slack-user-link-support</dependency>

        <transformation extension="less">
            <transformer key="lessTransformer"/>
        </transformation>

        <resource name="oauth2/view-slack-oauth-sessions.soy" type="soy" location="oauth2/view-slack-oauth-sessions.soy"/>
        <resource name="oauth2/view-slack-oauth-sessions.less.css" type="download" location="oauth2/view-slack-oauth-sessions.less"/>
    </web-resource>

    <servlet name="View OAuth Slack Servlet" key="slack-view-oauth-servlet"
             class="com.atlassian.plugins.slack.oauth2.ViewSlackOauthSessionsServlet">
        <url-pattern>/slack/view-oauth-sessions</url-pattern>
    </servlet>

    <!-- routing rest endpoints -->
    <routing key="slack-prettyurls" path="/slack">
        <route from="/{path: .*}" to="/rest/slack/1.0/{path}"/>
    </routing>

    <servlet-filter name="Signature verifying filter"
                    key="slack-signature-verifying-filter"
                    class="com.atlassian.plugins.slack.rest.RequestCachingServletFilter"
                    location="after-encoding"
                    weight="-100">
        <url-pattern>/rest/slack/latest/event</url-pattern>
        <url-pattern>/rest/slack/latest/command</url-pattern>
        <url-pattern>/slack/event</url-pattern>
        <url-pattern>/slack/command</url-pattern>
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>FORWARD</dispatcher>
    </servlet-filter>

    <servlet-filter name="Visited Links Analytics Filter"
                    key="slack-visited-links-analytics-filter"
                    class="com.atlassian.plugins.slack.analytics.SlackAnalyticsFilter"
                    location="before-decoration">
        <url-pattern>/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
    </servlet-filter>

    <velocity-allowlist key="velocity-allowlist-slack-plugin">
        <method>com.atlassian.jira.plugins.slack.spi.impl.JiraSlackPluginResourceProvider#getPluginKey()</method>
    </velocity-allowlist>

</atlassian-plugin>
